# Ідэі

Аляксей Станкевіч, вечар 28 III 2015

* Ёсць ядро працэсара, з невялікай але хуткай памяццю (да 1000 машынных слоў, не больш)

* Ёсць агульная звычайная памяць

* Рэгістры агульнага прызначэння не патрэбны, патрэбны толькі індэксныя і службовыя рэгістры.

Трэба прадумаць:

1. Арганізацыю унутранай і знешняй памяці.

2. Абарону для шматзадачнасці

3. Узаемадзеянне з перыфірыяй

4. Набор каманд.

_________________

Андрей Позняк, 17:52 03 IV 2015

* Процессор будет "регистрировать" активную периферию, выделяя ей область из быстрой памяти, через которую она сможет общаться с   процессором.

* Быстрая и общая память в едином адресном пространстве (пример: адреса быстрой - 0x0 .. 0xFFFF обычной - 0x10000 ..)

* Общие данные при многозадачности лежат в быстрой памяти, а в общей памяти для каждого процесса выделяется своя память, без общего доступа к ней по умолчанию, но с возможностью снять это ограничение.

* Команды предлагаю позаимствовать из Стекплетрона, только команды, где используется регистр Аккумулятор (А) немного изменить: создать новый регистр адреса и при вызове SUM(addr) сумма будет вычисляться между значениями в ячейках с индексами addr и значением регистра адреса, а резальтат запишется в ячайку с индексом регистра адреса.
_______________

Аляксей Станкевіч, раніца 05 IV 2015 

Трэба прадумаць рэалізацыю косвеннай і прамой адрасацыі.

* Як варыянт: усконасць ці непасрэднасць вызначаюцца бітам у машынным слове, асобны біт за крыніцу і асобны біт за прызначэнне. Напрыклад, хай `mov` мае opcode `0x01` тады:

1. `mov R0x00 M0x1073C` будзе выглядаць як `0b000 00001 0x0000 0000 0x0001 073C`
2. `mov [R0x00] M0x1073C` будзе выглядаць як `0b010 00001 0x0000 0000 0x0001 073C`
3. `mov R0x00 [R0xFE]` будзе выглядаць як `0b001 00001 0x0000 0000 0x0000 00FE`

_______________


Аляксей Станкевіч, вечар 06 IV 2015
UPD: раніца 15 IV 2015

Для варыянта 2 з галасавання прыблізны варыянт арганізацыі машынных слоў:

|mnemonic    |binary                                    |hex        |
|-----------:|:-----------------------------------------|:----------|
|__NOP__     |0000_0000__0000_0000__0000_0000__0000_0000|0x0000_0000|
|SYSCALL     |0000_0000__0000_0000__0000_0000__0000_0001|0x0000_0001|
|            |                                          |           |
|__NOT__     |0000_0000__0000_0000__0000_0000__0001_0000|0x0000_0010|
|AND         |0000_0000__0000_0000__0000_0000__0001_0001|0x0000_0011|
|OR          |0000_0000__0000_0000__0000_0000__0001_0010|0x0000_0012|
|XOR         |0000_0000__0000_0000__0000_0000__0001_0011|0x0000_0013|
|SHL         |0000_0000__0000_0000__0000_0000__0001_0100|0x0000_0014|
|SHR         |0000_0000__0000_0000__0000_0000__0001_0101|0x0000_0015|
|SAL         |0000_0000__0000_0000__0000_0000__0001_0110|0x0000_0016|
|SAR         |0000_0000__0000_0000__0000_0000__0001_0111|0x0000_0017|
|SCL         |0000_0000__0000_0000__0000_0000__0001_1000|0x0000_0018|
|SCR         |0000_0000__0000_0000__0000_0000__0001_1001|0x0000_0019|
|            |                                          |           |
|__INC__     |0000_0000__0000_0000__0000_0000__0010_0000|0x0000_0020|
|DEC         |0000_0000__0000_0000__0000_0000__0010_0001|0x0000_0021|
|IPADD       |0000_0000__0000_0000__0000_0000__0010_0010|0x0000_0022|
|IPSUB       |0000_0000__0000_0000__0000_0000__0010_0011|0x0000_0023|
|ADD         |0000_0000__0000_0000__0000_0000__0010_0100|0x0000_0024|
|SUB         |0000_0000__0000_0000__0000_0000__0010_0101|0x0000_0025|
|UMUL        |0000_0000__0000_0000__0000_0000__0010_1000|0x0000_0028|
|UDIV        |0000_0000__0000_0000__0000_0000__0010_1001|0x0000_0029|
|MUL         |0000_0000__0000_0000__0000_0000__0010_1010|0x0000_002A|
|DIV         |0000_0000__0000_0000__0000_0000__0010_1011|0x0000_002B|
|            |                                          |           |
|__CMP__     |0000_0000__0000_0000__0000_0000__0011_0000|0x0000_0030|
|JMP         |0000_0000__0000_0000__0000_0000__0011_0001|0x0000_0031|
|JE          |0000_0000__0000_0000__0000_0000__0011_0010|0x0000_0032|
|JNE         |0000_0000__0000_0000__0000_0000__0011_0011|0x0000_0033|
|JGR         |0000_0000__0000_0000__0000_0000__0011_0100|0x0000_0034|
|JLS         |0000_0000__0000_0000__0000_0000__0011_0101|0x0000_0035|
|JHG         |0000_0000__0000_0000__0000_0000__0011_0110|0x0000_0036|
|JLW         |0000_0000__0000_0000__0000_0000__0011_0111|0x0000_0037|
|            |                                          |           |
|__MOV__     |0000_0000__0000_0000__0000_0000__0100_0000|0x0000_0040|
|INT         |0000_0000__0000_0000__0000_0000__0100_0001|0x0000_0041|
|SLI         |0000_0000__0000_0000__0000_0000__0100_0010|0x0000_0042|
|CLI         |0000_0000__0000_0000__0000_0000__0100_0011|0x0000_0043|
|HLT         |0000_0000__0000_0000__0000_0000__0100_1111|0x0000_004F|

upd: дзень 15 IV 2015

флагі __колькасці__ парметраў:

|колькасць|binary                                    |hex        |
|:--------|:-----------------------------------------|:----------|
|0        |0000_0000__0000_0000__0000_0000__0000_0000|0x0000_0000|
|1        |0000_0001__0000_0000__0000_0000__0000_0000|0x0100_0000|
|2        |0000_0011__0000_0000__0000_0000__0000_0000|0x0300_0000|
|3        |0000_0111__0000_0000__0000_0000__0000_0000|0x0700_0000|
|4        |0000_1111__0000_0000__0000_0000__0000_0000|0x0F00_0000|

флагі __ускоснасці__:

|параметр|binary                                    |hex        |
|:------:|:-----------------------------------------|:----------|
|першы   |0000_0000__0000_0001__0000_0000__0000_0000|0x0001_0000|
|другі   |0000_0000__0000_0010__0000_0000__0000_0000|0x0002_0000|
|трэці   |0000_0000__0000_0100__0000_0000__0000_0000|0x0004_0000|
|чацвёрты|0000_0000__0000_1000__0000_0000__0000_0000|0x0008_0000|

флагі __непасрэднасці__:

|параметр|binary                                    |hex        |
|:------:|:-----------------------------------------|:----------|
|першы   |0000_0000__0001_0000__0001_0000__0000_0000|0x0010_0000|
|другі   |0000_0000__0010_0000__0010_0000__0000_0000|0x0020_0000|
|трэці   |0000_0000__0100_0000__0100_0000__0000_0000|0x0040_0000|
|чацвёрты|0000_0000__1000_0000__1000_0000__0000_0000|0x0080_0000|

upd: дзень 15 IV 2015

флагі __чытання__:

|параметр|binary                                    |hex        |
|:------:|:-----------------------------------------|:----------|
|першы   |0000_0000__0000_0000__0000_0001__0000_0000|0x0000_0100|
|другі   |0000_0000__0000_0000__0000_0010__0000_0000|0x0000_0200|
|трэці   |0000_0000__0000_0000__0000_0100__0000_0000|0x0000_0400|
|чацвёрты|0000_0000__0000_0000__0000_1000__0000_0000|0x0000_0800|

флагі __запісу__:

|параметр|binary                                    |hex        |
|:------:|:-----------------------------------------|:----------|
|першы   |0000_0000__0000_0000__0001_0000__0000_0000|0x0000_1000|
|другі   |0000_0000__0000_0000__0010_0000__0000_0000|0x0000_2000|
|трэці   |0000_0000__0000_0000__0100_0000__0000_0000|0x0000_4000|
|чацвёрты|0000_0000__0000_0000__1000_0000__0000_0000|0x0000_8000|

флагі __размеру у байтах__ парметраў:

|колькасць|binary                                    |hex        |
|:--------|:-----------------------------------------|:----------|
|1        |0001_0000__0000_0000__0000_0000__0000_0000|0x1000_0000|
|2        |0010_0000__0000_0000__0000_0000__0000_0000|0x2000_0000|
|4        |0100_0000__0000_0000__0000_0000__0000_0000|0x4000_0000|

_______________

Аляксей Станкевіч, вечар 09 IV 2015 

Я сапраўды забыўся mov і не зусім ведаю куды яго аднесці. Ноп у мяне цалкам асобны, другая група логіка, трэцяя арыфметыка, чацвёртае пераходы, пятая кіручыя каманды (для АС).

Магчыма syscall занесці у чацвёртую групу, тады у пятай будуць толькі каманды якія можна выконваць ад імя аперацыйнай сістэмы. А mov усё роўна не зразумела куды аднесці можа ў 4?

Таксама ідэя якую сёння выказваў Андрэю: усе аперацыі выконваем у асаблівым рэгістры. Напрыклад у яго грузіцца першы і другі аперанд, і вылічаецца вынік які заносіцца туды куды прызначана. Можна забараніць усе інструкцыі акрамя mov каб выконваліся напрамую ў агульна-маруднай памяці.

___________________

Радкевич Павел, вечер 10 IV 2015

Размышления в виде тезисов-предложений

* Отказываемся от аппаратной реализации сегментов. Твёдое "Нет" сегментным регистрам. Следствие: farные адреса памяти и переходы (любой, даже ближний адрес - 32 бита).

* В обычной (большой) памяти выделяются области, представляющие собой буферы для работы с устройствами ввода/вывода. Взаимодействие с последними можно производить только через эти буферы. Области регистрируются строго при проектировании машины. Например: область памяти [A0000..B0000] представляет собой видеобуфер, любые изменения в ней приведут к изменениям на экране (там же управляющие байты видеорежимов, всё в лучших традициях доса).

* К вопросу о многозадачности. Решение сего вопроса, на мой взгляд, имеет смысл отдать ОСи на 100%. Кто лучше оси знает, какой проц занят какой программой? Делать же полноценную вытесняющую многозадачность (для каждого проца по временным квотам), мне кажется, не стоит, а то до отъезда не управимся. А хочется еще под осьАПИ попрогать.

* Защита памяти только программная (ОС). То есть ось задаёт таблицу прерываний/сисколлов и уходит в NOOP. По мере обработки действий пользователя или внешних устройств, наваливает работы процам, разрешает запросы от проца на память.

_________________

Андрей Позняк, ранний вечер 11 IV 2015

* Процессор общается с железом через определённые команды определённой длинны. То есть, например, оперативная память получает от процессора, например, 32 бита информации, на которые она каким-то образом реагирует. Поэтому, если думать о более правдоподоюной симуляции, то, возможно, стоит подумать о том, что вместо вспомогательных функций write writeRange и т.д. нужно использовать более правдоподобный интерфейс (проц посылает оперативной сигнал через шину а она высылает ответ).

_______________
